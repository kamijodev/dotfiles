---
name: pr-review
description: PRの差分をレビューし、問題点や改善点を指摘する。「PRレビューして」「このPRを確認して」等の指示があった場合に使用。
---

# PR Review

Pull Requestの変更内容をレビューし、コードの問題点や改善点を指摘する。

## ワークフロー

1. 対象のPR/ブランチを確認
2. `git diff` または `gh pr diff` で差分を取得
3. 変更内容をレビュー
4. 問題点・改善点をまとめて報告

## レビュー観点

### 必須チェック

- **バグ**: ロジックエラー、境界条件
- **セキュリティ**: インジェクション、認証・認可、機密情報の露出
- **パフォーマンス**: N+1クエリ、不要なループ

#### フロントエンド
- FSDに従って実装されているか
- Container/Presentational Pattern に従って実装されているか

#### バックエンド
- クラスのメソッドが不要な公開(public)状態でないか
- トランザクション内にDB操作以外（外部API呼び出し、データ整形、ビジネスロジック等）が含まれていないか。トランザクションはDB操作のみに限定し、それ以外はトランザクション外で行う

### 推奨チェック

- **可読性**: 命名、コードの複雑さ
- **保守性**: 重複コード、責務の分離
- **テスト**: テストの有無、カバレッジ
- **早期return**: ネストが深い条件分岐をガード節（早期return）でフラット化できないか確認
- **重複処理**: 関数間・関数内で同じロジックが繰り返されていないか確認。コピペブロックや微差の繰り返し条件分岐は共通化を提案
- **mutation後の不要なrefetch**: GraphQL mutationの後に`refetch()`を呼んでいる場合、mutationの`returning`句で更新フィールドを返してキャッシュを自動更新させるよう提案。`refetchQueries`も同様。単一・バッチmutation(`update_many`)の両方が対象

## 出力形式

```markdown
## レビュー結果

### 問題点
- [ ] **[重要度]** ファイル名:行番号 - 問題の説明

### 改善提案
- ファイル名:行番号 - 提案内容

### 良い点
- 良かった点があれば記載
```

## 重要度

| レベル | 説明 |
|--------|------|
| `CRITICAL` | マージ前に必ず修正が必要 |
| `MAJOR` | 修正を強く推奨 |
| `MINOR` | 可能であれば修正 |
| `SUGGESTION` | 参考程度 |

## 使用例

```bash
# 現在のブランチとmainの差分をレビュー
gh pr diff | ...

# 特定のPRをレビュー
gh pr view <number> --json files,additions,deletions
gh pr diff <number>
```
